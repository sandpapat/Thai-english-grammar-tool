{% extends "base.html" %}

{% block title %}{% if get_current_locale() == 'th' %}ประสิทธิภาพ Pipeline - Thaislate{% else %}Pipeline Performance - Thaislate{% endif %}{% endblock %}

{% block content %}
<style>
    /* CSS Variables for theme-aware colors */
    :root {
        --pipeline-hero-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --pipeline-hero-text: white;
        --badge-excellent-bg: #d4edda;
        --badge-excellent-text: #155724;
        --badge-good-bg: #cce5ff;
        --badge-good-text: #004085;
        --badge-moderate-bg: #fff3cd;
        --badge-moderate-text: #856404;
        --timing-stat-bg: #f8f9fa;
        --distribution-bar-bg: #e9ecef;
        --recommendation-card-bg: #f8f9fa;
    }
    
    [data-theme="dark"] {
        --pipeline-hero-bg: linear-gradient(135deg, #5b69c3 0%, #6b4099 100%);
        --pipeline-hero-text: white;
        --badge-excellent-bg: rgba(25, 135, 84, 0.2);
        --badge-excellent-text: #40d989;
        --badge-good-bg: rgba(13, 110, 253, 0.2);
        --badge-good-text: #6ea8fe;
        --badge-moderate-bg: rgba(255, 193, 7, 0.2);
        --badge-moderate-text: #ffda6a;
        --timing-stat-bg: var(--bg-secondary);
        --distribution-bar-bg: var(--bg-tertiary);
        --recommendation-card-bg: var(--bg-secondary);
    }
    
    .hero-section {
        background: var(--pipeline-hero-bg);
        color: var(--pipeline-hero-text);
        padding: 3rem 0;
        margin: -2rem -12px 3rem -12px;
        border-radius: 0 0 1rem 1rem;
    }
    .metric-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        transition: transform 0.2s;
        height: 100%;
        color: var(--text-primary);
    }
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--card-shadow-hover);
    }
    .performance-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    .excellent { background-color: var(--badge-excellent-bg); color: var(--badge-excellent-text); }
    .good { background-color: var(--badge-good-bg); color: var(--badge-good-text); }
    .moderate { background-color: var(--badge-moderate-bg); color: var(--badge-moderate-text); }
    .progress-custom {
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
    }
    .score-display {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--pipeline-hero-text);
    }
    .timing-stat {
        background: var(--timing-stat-bg);
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
        color: var(--text-primary);
    }
    .distribution-bar {
        background: var(--distribution-bar-bg);
        height: 30px;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
    }
    .distribution-fill {
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        padding: 0 1rem;
        color: white;
        font-weight: 500;
        font-size: 0.875rem;
    }
    .recommendation-card {
        background: var(--recommendation-card-bg);
        border-left: 4px solid #667eea;
        padding: 1.5rem;
        border-radius: 0 8px 8px 0;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }
</style>

<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <h1 class="display-5 fw-bold mb-3">
            <i class="bi bi-diagram-3"></i> 
            {% if get_current_locale() == 'th' %}
                ประสิทธิภาพ Pipeline เต็มรูปแบบ
            {% else %}
                Full Pipeline Performance
            {% endif %}
        </h1>
        <h2 class="h4 mb-4">
            {% if get_current_locale() == 'th' %}
                การประเมินแบบครบวงจร: การแปล + การจำแนก + การอธิบาย
            {% else %}
                End-to-End Evaluation: Translation + Classification + Explanation
            {% endif %}
        </h2>
        <div class="row">
            <div class="col-md-4">
                <div class="text-center">
                    <div class="score-display">96</div>
                    <p class="lead mb-0">
                        {% if get_current_locale() == 'th' %}ตัวอย่างทดสอบ{% else %}Test Samples{% endif %}
                    </p>
                    <small style="opacity: 0.8;">
                        {% if get_current_locale() == 'th' %}การประเมินแบบครอบคลุม{% else %}Comprehensive evaluation{% endif %}
                    </small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <div class="score-display">7</div>
                    <p class="lead mb-0">
                        {% if get_current_locale() == 'th' %}เมตริก{% else %}Metrics{% endif %}
                    </p>
                    <small style="opacity: 0.8;">
                        {% if get_current_locale() == 'th' %}การประเมินหลายมิติ{% else %}Multi-aspect evaluation{% endif %}
                    </small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <div class="score-display">12.25s</div>
                    <p class="lead mb-0">
                        {% if get_current_locale() == 'th' %}เวลาเฉลี่ย{% else %}Avg Time{% endif %}
                    </p>
                    <small style="opacity: 0.8;">
                        {% if get_current_locale() == 'th' %}การประมวลผลทั้งหมด{% else %}Total processing{% endif %}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Test Overview -->
<section class="mb-5">
    <div class="alert alert-primary border-primary">
        <div class="row align-items-center">
            <div class="col-md-1">
                <i class="bi bi-gear-fill text-primary fs-1"></i>
            </div>
            <div class="col-md-11">
                <h5 class="alert-heading mb-2">
                    {% if get_current_locale() == 'th' %}
                        การประเมิน Pipeline แบบครบถ้วน
                    {% else %}
                        Complete Pipeline Evaluation
                    {% endif %}
                </h5>
                <p class="mb-0">
                    {% if get_current_locale() == 'th' %}
                        การประเมินนี้ทดสอบ <strong>ระบบทั้งหมดแบบครบวงจร</strong>: 
                        ข้อมูลภาษาไทย → การแปล → การจำแนก Tense → การสร้างคำอธิบายไวยากรณ์ 
                        รวมถึงการประเมินโดยมนุษย์เกี่ยวกับคุณภาพการแปล ความถูกต้องของคำอธิบาย และความสะดวกในการใช้งาน
                    {% else %}
                        This evaluation tests the <strong>entire system end-to-end</strong>: Thai text input → Translation → 
                        Tense Classification → Grammar Explanation generation. Includes human evaluation of translation quality, 
                        explanation correctness, and system usability.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Component Performance Scores -->
<section class="mb-5">
    <h3 class="mb-4">
        {% if get_current_locale() == 'th' %}
            การแยกประสิทธิภาพตามส่วนประกอบ
        {% else %}
            Component Performance Breakdown
        {% endif %}
    </h3>
    <div class="row g-4">
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-translate me-2 text-primary"></i>
                    {% if get_current_locale() == 'th' %}
                        ความลื่นของการแปล
                    {% else %}
                        Translation Fluency
                    {% endif %}
                </h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">93.2%</span>
                    <span class="performance-badge excellent">
                        {% if get_current_locale() == 'th' %}ยอดเยี่ยม{% else %}Excellent{% endif %}
                    </span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-success" style="width: 93.2%"></div>
                </div>
                <small class="text-muted">
                    {% if get_current_locale() == 'th' %}
                        คะแนน 1.865/2 - Typhoon Translate 4B
                    {% else %}
                        1.865/2 score - Typhoon Translate 4B
                    {% endif %}
                </small>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-check-double me-2 text-primary"></i>
                    {% if get_current_locale() == 'th' %}
                        การรักษาความหมาย
                    {% else %}
                        Meaning Preservation
                    {% endif %}
                </h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">90.6%</span>
                    <span class="performance-badge excellent">
                        {% if get_current_locale() == 'th' %}ดีมาก{% else %}Very Good{% endif %}
                    </span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-success" style="width: 90.6%"></div>
                </div>
                <small class="text-muted">
                    {% if get_current_locale() == 'th' %}
                        คะแนน 1.813/2 - ความแม่นยำทางความหมาย
                    {% else %}
                        1.813/2 score - Semantic accuracy
                    {% endif %}
                </small>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-clock me-2 text-primary"></i>{% if get_current_locale() == 'th' %}การจำแนกหลัก{% else %}Coarse Classification{% endif %}</h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">92.7%</span>
                    <span class="performance-badge excellent">{% if get_current_locale() == 'th' %}ยอดเยี่ยม{% else %}Excellent{% endif %}</span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-success" style="width: 92.7%"></div>
                </div>
                <small class="text-muted">{% if get_current_locale() == 'th' %}คะแนน 0.927/1 - อดีต/ปัจจุบัน/อนาคต{% else %}0.927/1 score - Past/Present/Future{% endif %}</small>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-bullseye me-2 text-primary"></i>{% if get_current_locale() == 'th' %}การจำแนกละเอียด{% else %}Fine-grained Classification{% endif %}</h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">74.0%</span>
                    <span class="performance-badge moderate">{% if get_current_locale() == 'th' %}ปานกลาง{% else %}Moderate{% endif %}</span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-warning" style="width: 74%"></div>
                </div>
                <small class="text-muted">{% if get_current_locale() == 'th' %}คะแนน 0.740/1 - 24 ประเภท Tense{% else %}0.740/1 score - 24 tense classes{% endif %}</small>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-book me-2 text-primary"></i>{% if get_current_locale() == 'th' %}คุณภาพคำอธิบาย{% else %}Explanation Quality{% endif %}</h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">84.9%</span>
                    <span class="performance-badge good">{% if get_current_locale() == 'th' %}ดี{% else %}Good{% endif %}</span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-info" style="width: 84.9%"></div>
                </div>
                <small class="text-muted">{% if get_current_locale() == 'th' %}คะแนน 1.698/2 - Typhoon 2.1 4B Instruct{% else %}1.698/2 score - Typhoon 2.1 4B Instruct{% endif %}</small>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-shield-check me-2 text-primary"></i>{% if get_current_locale() == 'th' %}ไม่มีข้อผิดพลาดในคำอธิบาย{% else %}No Code Hallucination{% endif %}</h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">77.1%</span>
                    <span class="performance-badge moderate">{% if get_current_locale() == 'th' %}ปานกลาง{% else %}Moderate{% endif %}</span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-warning" style="width: 77.1%"></div>
                </div>
                <small class="text-muted">{% if get_current_locale() == 'th' %}คะแนน 0.771/1 - ความชัดเจนของคำอธิบาย{% else %}0.771/1 score - Explanation clarity{% endif %}</small>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="metric-card">
                <h5><i class="bi bi-search me-2 text-primary"></i>{% if get_current_locale() == 'th' %}การตรวจจับคำสัญญาณ{% else %}Signal Word Detection{% endif %}</h5>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="h3 mb-0">95.8%</span>
                    <span class="performance-badge excellent">{% if get_current_locale() == 'th' %}ยอดเยี่ยม{% else %}Excellent{% endif %}</span>
                </div>
                <div class="progress progress-custom">
                    <div class="progress-bar bg-success" style="width: 95.8%"></div>
                </div>
                <small class="text-muted">{% if get_current_locale() == 'th' %}คะแนน 0.958/1 - ตัวบ่งชี้เวลา{% else %}0.958/1 score - Temporal markers{% endif %}</small>
            </div>
        </div>
    </div>
</section>

<!-- Performance Timing -->
<section class="mb-5">
    <h3 class="mb-4">
        {% if get_current_locale() == 'th' %}
            การวิเคราะห์เวลาประสิทธิภาพ
        {% else %}
            Performance Timing Analysis
        {% endif %}
    </h3>
    <div class="row g-3">
        <div class="col-md-4">
            <div class="timing-stat">
                <i class="bi bi-lightning-fill text-success fs-1 mb-2"></i>
                <h4>1.20s</h4>
                <p class="mb-0">Translation Time</p>
                <small class="text-muted">Fast inference</small>
            </div>
        </div>
        <div class="col-md-4">
            <div class="timing-stat">
                <i class="bi bi-cpu-fill text-warning fs-1 mb-2"></i>
                <h4>10.26s</h4>
                <p class="mb-0">Explanation Time</p>
                <small class="text-muted">Needs optimization</small>
            </div>
        </div>
        <div class="col-md-4">
            <div class="timing-stat">
                <i class="bi bi-stopwatch-fill text-primary fs-1 mb-2"></i>
                <h4>11.47s</h4>
                <p class="mb-0">Total Pipeline Time</p>
                <small class="text-muted">Excludes cold start</small>
            </div>
        </div>
    </div>
    
    <div class="alert alert-info mt-4">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Note:</strong> Timing measurements exclude cold start response (first inference) to provide accurate warm-state performance metrics.
    </div>
</section>

<!-- Score Distribution -->
<section class="mb-5">
    <h3 class="mb-4">
        {% if get_current_locale() == 'th' %}
            การวิเคราะห์การกระจายคะแนน
        {% else %}
            Score Distribution Analysis
        {% endif %}
    </h3>
    <div class="row g-4">
        <div class="col-md-6">
            <h5>Translation Fluency Distribution</h5>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Perfect (Score 2)</span>
                    <span>86.5%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill" style="width: 86.5%">83/96</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Good (Score 1)</span>
                    <span>13.5%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill bg-warning" style="width: 13.5%">13/96</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Poor (Score 0)</span>
                    <span>0%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill bg-danger" style="width: 0%">0/96</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <h5>Meaning Preservation Distribution</h5>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Perfect (Score 2)</span>
                    <span>82.3%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill" style="width: 82.3%">79/96</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Partial (Score 1)</span>
                    <span>16.7%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill bg-warning" style="width: 16.7%">16/96</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Poor (Score 0)</span>
                    <span>1.0%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill bg-danger" style="width: 1%">1/96</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row g-4 mt-2">
        <div class="col-md-6">
            <h5>Fine-grained Classification Distribution</h5>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Correct</span>
                    <span>74.0%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill" style="width: 74%">71/96</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Incorrect</span>
                    <span>26.0%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill bg-danger" style="width: 26%">25/96</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <h5>Code Hallucination Analysis</h5>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Clean Explanations</span>
                    <span>77.1%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill" style="width: 77.1%">74/96</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                    <span>Contains Technical Jargon</span>
                    <span>22.9%</span>
                </div>
                <div class="distribution-bar">
                    <div class="distribution-fill bg-warning" style="width: 22.9%">22/96</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Key Findings -->
<section class="mb-5">
    <h3 class="mb-4">
        {% if get_current_locale() == 'th' %}
            ผลการค้นพบสำคัญ
        {% else %}
            Key Findings
        {% endif %}
    </h3>
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-star-fill me-2"></i>
                        {% if get_current_locale() == 'th' %}
                            จุดแข็งของ Pipeline
                        {% else %}
                            Pipeline Strengths
                        {% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li><strong>Translation Quality:</strong> 93.2% fluency rate</li>
                        <li><strong>Coarse Classification:</strong> 92.7% accuracy</li>
                        <li><strong>Signal Word Detection:</strong> 95.8% success rate</li>
                        <li><strong>Speed:</strong> Fast translation (1.20s average)</li>
                        <li><strong>No Translation Failures:</strong> 0% poor translations</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-warning">
                <div class="card-header bg-warning">
                    <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>
                        {% if get_current_locale() == 'th' %}
                            จุดที่ต้องปรับปรุง
                        {% else %}
                            Areas for Improvement
                        {% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li><strong>Fine-grained Classification:</strong> 74% accuracy (18 failed cases)</li>
                        <li><strong>Code Hallucination:</strong> 23% of explanations contain technical jargon</li>
                        <li><strong>Explanation Speed:</strong> 11s average generation time</li>
                        <li><strong>Edge Cases:</strong> Progressive vs. continuous aspects confusion</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>



{% endblock %}
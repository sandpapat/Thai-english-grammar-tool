{% extends "base.html" %}

{% block title %}Home - Thai-English Grammar Learning Tool{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-body">
                <h1 class="card-title text-center mb-4">
                    <i class="bi bi-chat-text"></i> Thai-English Grammar Learning Tool
                </h1>
                
                <p class="text-center text-muted mb-4">
                    Enter a Thai sentence to analyse its English translation and tense
                </p>

                <form method="POST" action="{{ url_for('predict') }}" id="analyseForm">
                    <div class="mb-4">
                        <label for="thai_text" class="form-label">
                            <i class="bi bi-pencil-square"></i> Thai Sentence
                        </label>
                        <textarea 
                            class="form-control form-control-lg" 
                            id="thai_text" 
                            name="thai_text" 
                            rows="3" 
                            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
                            required
                            autofocus
                        ></textarea>
                        <div class="form-text">
                            Example: ‡∏â‡∏±‡∏ô‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ä‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô, ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏â‡∏±‡∏ô‡πÑ‡∏õ‡∏ï‡∏•‡∏≤‡∏î, ‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i class="bi bi-play-circle"></i> Analyse
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Progress Bar Container -->
        <div id="progressContainer" class="d-none mt-4">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title text-center mb-3">
                        <i class="bi bi-gear-fill"></i> Processing Analysis
                    </h5>
                    
                    <div class="progress mb-3" style="height: 25px;">
                        <div id="progressBar" 
                             class="progress-bar progress-bar-striped progress-bar-animated bg-primary" 
                             role="progressbar" 
                             style="width: 0%"
                             aria-valuenow="0" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <div id="progressIcon" style="font-size: 3rem;" class="mb-2">üîÑ</div>
                        <h6 id="progressText" class="mb-1">Starting analysis...</h6>
                        <p id="progressTextThai" class="text-muted small mb-0">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="d-none mt-4">
            <!-- Results will be dynamically inserted here -->
        </div>

        <!-- Information Cards -->
        <div class="row mt-4">
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-translate text-primary" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Translation</h5>
                        <p class="card-text small">
                            Thai to English using Typhoon Translate 4B
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-tags text-success" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Classification</h5>
                        <p class="card-text small">
                            Tense detection using XLM-RoBERTa
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-lightbulb text-warning" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Explanation</h5>
                        <p class="card-text small">
                            Grammar tips using Typhoon 2.1 Instruct
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Simple mock progress bar with form submission
    document.getElementById('analyseForm').addEventListener('submit', function(e) {
        const thai_text = document.getElementById('thai_text').value.trim();
        
        if (!thai_text) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ / Please enter Thai text');
            e.preventDefault();
            return;
        }
        
        // Show progress bar and disable form
        const progressContainer = document.getElementById('progressContainer');
        const submitBtn = document.getElementById('submitBtn');
        
        progressContainer.classList.remove('d-none');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Processing...';
        
        // Start mock progress animation
        startMockProgress();
        
        // Let the form submit normally - don't prevent it
        // The progress bar will show during the actual processing
    });
    
    function startMockProgress() {
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressTextThai = document.getElementById('progressTextThai');
        const progressIcon = document.getElementById('progressIcon');
        
        let currentStep = 1;
        let currentProgress = 0;
        
        const steps = [
            {step: 1, duration: 1500, endProgress: 33, message: "Translating...", messageThai: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•...", icon: "üî§"},
            {step: 2, duration: 1500, endProgress: 66, message: "Classifying tense...", messageThai: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Å‡∏≤‡∏•...", icon: "üè∑Ô∏è"},
            {step: 3, duration: 2000, endProgress: 100, message: "Generating explanation...", messageThai: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢...", icon: "üí°"}
        ];
        
        function animateStep(stepIndex) {
            if (stepIndex >= steps.length) return;
            
            const step = steps[stepIndex];
            const startProgress = stepIndex === 0 ? 0 : steps[stepIndex - 1].endProgress;
            const progressIncrement = (step.endProgress - startProgress) / (step.duration / 50);
            
            // Update step info
            progressText.textContent = step.message;
            progressTextThai.textContent = step.messageThai;
            progressIcon.textContent = step.icon;
            
            const progressInterval = setInterval(() => {
                currentProgress += progressIncrement;
                
                if (currentProgress >= step.endProgress) {
                    currentProgress = step.endProgress;
                    progressBar.style.width = currentProgress + '%';
                    progressBar.setAttribute('aria-valuenow', currentProgress);
                    
                    clearInterval(progressInterval);
                    
                    // Move to next step after a brief pause
                    setTimeout(() => {
                        animateStep(stepIndex + 1);
                    }, 200);
                } else {
                    progressBar.style.width = currentProgress + '%';
                    progressBar.setAttribute('aria-valuenow', currentProgress);
                }
            }, 50);
        }
        
        // Start the animation
        animateStep(0);
    }
</script>
{% endblock %}
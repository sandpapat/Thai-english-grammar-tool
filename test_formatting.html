<!DOCTYPE html>
<html>
<head>
    <title>Formatting Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="app/static/css/style.css">
</head>
<body>
    <div class="container mt-4">
        <h2>Explanation Formatting Test</h2>
        
        <div class="card shadow mb-4">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">
                    <i class="bi bi-lightbulb"></i> Grammar Explanation
                </h4>
            </div>
            <div class="card-body">
                <!-- Test formatted content -->
                <div class="mb-4">
                    <h5 class="text-primary">
                        <i class="bi bi-bookmark"></i> วิเคราะห์ Tense ที่ใช้
                    </h5>
                    <div class="ps-3">
                        <div class="explanation-content">
                            <p class="mb-2">ประโยคภาษาอังกฤษ "This heart cannot forget" ใช้ <strong class="text-primary">Present Simple</strong></p>
                            
                            <p class="mb-2"><strong class="text-primary">Present Simple:</strong> <span class="definition-text">ใช้เพื่อแสดงข้อเท็จจริง ความจริงสากล นิสัย หรือสถานการณ์ที่ไม่เปลี่ยนแปลงไปตามเวลา</span></p>
                            
                            <p class="mb-2">ในบริบทของประโยคนี้ การที่หัวใจ "ไม่สามารถ" ลืม เป็นสภาวะหรือลักษณะที่ถาวร ไม่ได้ผันแปรตามช่วงเวลาใดๆ</p>
                            
                            <p class="mb-2"><strong class="text-primary">โครงสร้าง:</strong> <span class="definition-text">ประโยคมีโครงสร้างแบบ Subject + Verb (Subject คือ "This heart", Verb คือ "cannot forget") ซึ่งเป็นรูปแบบพื้นฐานของ Present Simple</span></p>
                        </div>
                    </div>
                </div>
                
                <hr class="my-3">
                
                <div class="mb-4">
                    <h5 class="text-primary">
                        <i class="bi bi-bookmark"></i> คำศัพท์ที่น่าสนใจ
                    </h5>
                    <div class="ps-3">
                        <div class="explanation-content">
                            <p class="mb-2"><strong class="text-primary">Cannot:</strong> <span class="definition-text">แสดงความไม่สามารถหรือความเป็นไปไม่ได้อย่างชัดเจน</span></p>
                            
                            <p class="mb-2">การใช้ "cannot" แทน "can't" ในบริบทนี้เน้นย้ำความรู้สึกที่จริงจัง และมีน้ำหนักมากกว่า</p>
                        </div>
                    </div>
                </div>
                
                <hr class="my-3">
                
                <div class="mb-4">
                    <h5 class="text-primary">
                        <i class="bi bi-bookmark"></i> ข้อผิดพลาดที่พบบ่อย
                    </h5>
                    <div class="ps-3">
                        <div class="explanation-content">
                            <p class="mb-2">ผู้เรียนไทยมักสับสนระหว่าง Present Simple กับ Present Continuous</p>
                            
                            <p class="mb-2"><strong class="text-primary">วิธีจำง่าย ๆ:</strong></p>
                            <p class="mb-2"><span class="bullet-point">•</span> Present Simple ใช้กับสิ่งที่เป็นความจริงถาวร</p>
                            <p class="mb-2"><span class="bullet-point">•</span> Present Continuous ใช้กับสิ่งที่กำลังเกิดขึ้นขณะนั้น</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <button onclick="testJavaScriptFormatting()" class="btn btn-primary">Test JavaScript Formatting</button>
        <div id="testOutput" class="mt-3"></div>
    </div>

    <script>
        function formatExplanationContent(content) {
            if (!content) return '';
            
            // Enhanced content formatting for better readability
            let formatted = content
                // Convert newlines to proper breaks
                .replace(/\n\n/g, '</p><p class="mb-2">')
                .replace(/\n/g, '<br>')
                
                // Format bold text with better styling
                .replace(/\*\*([^*]+)\*\*/g, '<strong class="text-primary">$1</strong>')
                
                // Add spacing around colons for definitions
                .replace(/(<strong[^>]*>[^<]*<\/strong>):\s*/g, '$1:</strong> <span class="definition-text">')
                .replace(/(<span class="definition-text">[^<]*)/g, '$1</span>')
                
                // Format bullet points
                .replace(/^\s*[•\-\*]\s+/gm, '<span class="bullet-point">• </span>')
                
                // Clean up extra spaces
                .replace(/\s+/g, ' ')
                .trim();
            
            // Wrap in paragraph tags if not already wrapped
            if (!formatted.startsWith('<p')) {
                formatted = '<p class="mb-2">' + formatted + '</p>';
            }
            
            return formatted;
        }

        function testJavaScriptFormatting() {
            const testContent = `ประโยคนี้ใช้ **Present Simple** เพื่อแสดงข้อเท็จจริง

**โครงสร้าง:** Subject + Verb

**ตัวอย่าง:**
- This is a fact.
- Water boils at 100°C.

**วิธีจำ:** ใช้กับสิ่งที่เป็นความจริงถาวร`;

            const formatted = formatExplanationContent(testContent);
            document.getElementById('testOutput').innerHTML = `
                <div class="card">
                    <div class="card-header">JavaScript Formatted Output</div>
                    <div class="card-body">
                        <div class="explanation-content">${formatted}</div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>